@{
    Layout = null;
}
<!DOCTYPE html>
<html>
<head>
    <title>Coding Zone后台管理</title>
    <link href="@Url.Content("~/Content/style.css")" rel="stylesheet" type="text/css" />
    <script src="@Url.Content("~/Scripts/jquery.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/common.js")" type="text/javascript"></script>
</head>
<body>
    <input type="hidden" id="hdIndex" value="@Url.Action("Index", "Home")" />
    <div class="login">
        <div class="login_form">
            <div class="form_info">
                <table cellpadding="0" cellspacing="0" width="400">
                    <tr style="height: 40px">
                        <td style="width: 70px; text-align: right">
                            用户名：
                        </td>
                        <td style="padding-left: 5px">
                            <input type="text" class="text" maxlength="20" id="txtLoginName" />
                            <span id="nameError" style="padding-left: 5px; color: Red"></span>
                        </td>
                    </tr>
                    <tr style="height: 40px">
                        <td style="width: 70px; text-align: right">
                            密&nbsp;&nbsp;&nbsp;码：
                        </td>
                        <td style="padding-left: 5px">
                            <input type="password" class="text" maxlength="20" id="txtLoginPwd" />
                            <span id="pwdError" style="padding-left: 5px; color: Red"></span>
                        </td>
                    </tr>
                    <tr style="height: 40px">
                        <td style="width: 70px; text-align: right">
                        </td>
                        <td style="padding-left: 5px; text-align: left">
                            <input type="button" class="button" onclick="UserLogin()" id="btnSubmit" />
                        </td>
                    </tr>
                    <tr>
                        <td>
                        </td>
                        <td id="messError" style="height: 20px; line-height: 20px; color: Red; padding-left: 5px;">
                        </td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
</body>
</html>
<script type="text/javascript">
    $(function () {
        InitPage();
    });
    function InitPage() {
        $("#txtLoginName").on("keypress", function (evt) {
            evt = (evt) ? evt : ((window.event) ? window.event : "") //兼容IE和Firefox获得keyBoardEvent对象  
            var key = evt.keyCode ? evt.keyCode : evt.which; //兼容IE和Firefox获得keyBoardEvent对象的键值  
            if (key == 13) { //判断是否是回车事件。 
                var txtLoginName = $("#txtLoginName");
                var txtLoginPwd = $("#txtLoginPwd");

                if ($.trim(txtLoginName.val()) != "" && txtLoginPwd.val() == "") {
                    txtLoginPwd.focus();
                }
                else {
                    UserLogin();
                }
            }
        });
        $("#txtLoginPwd").on("keypress", function (evt) {
            evt = (evt) ? evt : ((window.event) ? window.event : "") //兼容IE和Firefox获得keyBoardEvent对象  
            var key = evt.keyCode ? evt.keyCode : evt.which; //兼容IE和Firefox获得keyBoardEvent对象的键值  
            if (key == 13) { //判断是否是回车事件。 
                UserLogin();
            }
        })
    }

    var isSubmit = true;
    function UserLogin() {
        var loginName = $("#txtLoginName").val();
        var loginPwd = $("#txtLoginPwd").val();

        $("#nameError").html("");
        if (loginName == "" || $.trim(loginName) == "" || loginName == "用户名") {
            $("#nameError").html("请填写用户名!");
        }

        $("#pwdError").html("");
        if (loginPwd == "" || $.trim(loginPwd) == "") {
            $("#pwdError").html("请填写用户密码!");
            return;
        }

        if (isSubmit) {
            isSubmit = false;
            $.post("/Account/LogOn", { UserName: encodeURIComponent(loginName), Password: encodeURIComponent(loginPwd), randomNum: Math.random() }, function (data) {
                isSubmit = true;
                if (data != null) {
                    var strIndex = $("#hdIndex").val();
                    var goHref = getQueryString("ReturnUrl");
                    if (goHref == null || $.trim(goHref) == "")
                        goHref = strIndex;

                    if (data.Success) {
                        window.location = goHref;
                    } else {
                        $("#messError").html(data.Message);
                        return;
                    }
                }
            }, "json");
        }
    }
</script>
